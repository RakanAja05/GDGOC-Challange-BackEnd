{
    "openapi": "3.0.0",
    "info": {
        "title": "GDGoC API",
        "description": "API documentation for GDGoC Challenge",
        "version": "1.0.0"
    },
    "paths": {
        "/api/v1/ai/inbox": {
            "post": {
                "tags": [
                    "AI Insights"
                ],
                "summary": "Inbox AI (issue, sentiment, priority)",
                "description": "Auto-triggered after a customer message is saved. Only users with roles agent or lead can access this endpoint.",
                "operationId": "3c37fa8a6a0da88dbf35fdb5b7bb045e",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "conversation_id"
                                ],
                                "properties": {
                                    "conversation_id": {
                                        "type": "integer",
                                        "example": 1
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Inbox AI result",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "status": {
                                            "type": "string",
                                            "example": "success"
                                        },
                                        "data": {
                                            "properties": {
                                                "conversation_id": {
                                                    "type": "integer",
                                                    "example": 1
                                                },
                                                "issue_category": {
                                                    "type": "string",
                                                    "example": "login issue"
                                                },
                                                "sentiment": {
                                                    "type": "string",
                                                    "example": "negative"
                                                },
                                                "sentiment_score": {
                                                    "type": "number",
                                                    "example": 0.12
                                                },
                                                "priority": {
                                                    "type": "string",
                                                    "enum": [
                                                        "low",
                                                        "medium",
                                                        "high"
                                                    ],
                                                    "example": "high"
                                                }
                                            },
                                            "type": "object"
                                        },
                                        "meta": {
                                            "properties": {
                                                "issue": {
                                                    "type": "object",
                                                    "additionalProperties": true
                                                },
                                                "sentiment": {
                                                    "type": "object",
                                                    "additionalProperties": true
                                                },
                                                "priority": {
                                                    "type": "object",
                                                    "additionalProperties": true
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "403": {
                        "description": "Forbidden (role: agent or lead)"
                    },
                    "422": {
                        "description": "Validation error"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        },
        "/api/v1/ai/summary": {
            "post": {
                "tags": [
                    "AI Insights"
                ],
                "summary": "Conversation summary (on demand)",
                "description": "Generates summary once and caches it until a new message arrives.",
                "operationId": "965f1847b977ccebc864f61047c6cd74",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "conversation_id"
                                ],
                                "properties": {
                                    "conversation_id": {
                                        "type": "integer",
                                        "example": 1
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Summary result",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "status": {
                                            "type": "string",
                                            "example": "success"
                                        },
                                        "data": {
                                            "properties": {
                                                "conversation_id": {
                                                    "type": "integer",
                                                    "example": 1
                                                },
                                                "summary": {
                                                    "type": "string",
                                                    "example": "Customer cannot login."
                                                }
                                            },
                                            "type": "object"
                                        },
                                        "meta": {
                                            "properties": {
                                                "cached": {
                                                    "type": "boolean",
                                                    "example": false
                                                },
                                                "fallback": {
                                                    "type": "boolean",
                                                    "example": false
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "403": {
                        "description": "Forbidden (role: agent or lead)"
                    },
                    "422": {
                        "description": "Validation error"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        },
        "/api/v1/ai/reply": {
            "post": {
                "tags": [
                    "AI Insights"
                ],
                "summary": "Suggested reply (manual trigger)",
                "description": "Generates a fresh reply draft; no caching and no persistence.",
                "operationId": "b176cae2c2ee19ab679ab44d43468e8d",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "conversation_id"
                                ],
                                "properties": {
                                    "conversation_id": {
                                        "type": "integer",
                                        "example": 1
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Reply suggestion result",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "status": {
                                            "type": "string",
                                            "example": "success"
                                        },
                                        "data": {
                                            "properties": {
                                                "conversation_id": {
                                                    "type": "integer",
                                                    "example": 1
                                                },
                                                "reply": {
                                                    "type": "string",
                                                    "example": "Hi, we are checking your issue."
                                                }
                                            },
                                            "type": "object"
                                        },
                                        "meta": {
                                            "properties": {
                                                "fallback": {
                                                    "type": "boolean",
                                                    "example": false
                                                }
                                            },
                                            "type": "object"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "403": {
                        "description": "Forbidden (role: agent or lead)"
                    },
                    "422": {
                        "description": "Validation error"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        },
        "/api/email/verification/request": {
            "post": {
                "tags": [
                    "Email Verification"
                ],
                "summary": "Request email verification OTP",
                "description": "Always responds with success to avoid user enumeration.",
                "operationId": "f179ec2e95f2ab86efd92aaf46d0a07e",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "email"
                                ],
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "jane@example.com"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "OTP requested (sent if applicable)"
                    },
                    "422": {
                        "description": "Validation error"
                    }
                }
            }
        },
        "/api/email/verification/verify": {
            "post": {
                "tags": [
                    "Email Verification"
                ],
                "summary": "Verify email via OTP code",
                "operationId": "0b5b502f8660b62f68bda8ddf8e4abc5",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "email",
                                    "code"
                                ],
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "jane@example.com"
                                    },
                                    "code": {
                                        "description": "Digits-only OTP",
                                        "type": "string",
                                        "example": "123456"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Verified (or already verified)"
                    },
                    "422": {
                        "description": "Invalid/expired code or validation error"
                    }
                }
            }
        },
        "/api/email/verification/status": {
            "get": {
                "tags": [
                    "Email Verification"
                ],
                "summary": "Check email verification status",
                "operationId": "be41c0183e14e10b33e16c4f00425795",
                "parameters": [
                    {
                        "name": "email",
                        "in": "query",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "format": "email"
                        },
                        "example": "jane@example.com"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Status returned"
                    },
                    "422": {
                        "description": "Validation error"
                    }
                }
            }
        },
        "/api/email/verification/code": {
            "post": {
                "tags": [
                    "Email Verification"
                ],
                "summary": "Dev-only: get latest OTP code (local/testing only)",
                "description": "Dev-only: exposes the latest OTP code so the frontend can read it during local/testing.",
                "operationId": "dff9e0b2f62bc8973a304c6b0d84bd6b",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "email"
                                ],
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "jane@example.com"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "OTP code returned (dev only)"
                    },
                    "404": {
                        "description": "Not found / not available"
                    },
                    "422": {
                        "description": "Validation error"
                    }
                }
            }
        },
        "/api/login": {
            "post": {
                "tags": [
                    "Auth"
                ],
                "summary": "Login (returns Sanctum bearer token)",
                "operationId": "cdd44c14b1ad1560492fba76b3e0acaf",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "email",
                                    "password"
                                ],
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "jane@example.com"
                                    },
                                    "password": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "password"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "Token issued"
                    },
                    "401": {
                        "description": "Invalid credentials"
                    },
                    "409": {
                        "description": "Email not verified"
                    },
                    "422": {
                        "description": "Validation error"
                    }
                }
            }
        },
        "/api/logout": {
            "post": {
                "tags": [
                    "Auth"
                ],
                "summary": "Logout (revokes tokens)",
                "operationId": "53924128dee04e051387166ea9662a4c",
                "responses": {
                    "200": {
                        "description": "Logged out"
                    },
                    "401": {
                        "description": "Unauthenticated"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        },
        "/api/register": {
            "post": {
                "tags": [
                    "Auth"
                ],
                "summary": "Register (sends email verification OTP)",
                "operationId": "f25eacdab1284e12b28f83cb2b5a30b9",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "name",
                                    "email",
                                    "password",
                                    "password_confirmation"
                                ],
                                "properties": {
                                    "name": {
                                        "type": "string",
                                        "example": "Jane Doe"
                                    },
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "jane@example.com"
                                    },
                                    "password": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "password"
                                    },
                                    "password_confirmation": {
                                        "type": "string",
                                        "format": "password",
                                        "example": "password"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Registered (OTP sent)"
                    },
                    "422": {
                        "description": "Validation error"
                    }
                }
            }
        },
        "/api/conversations": {
            "get": {
                "tags": [
                    "Conversations"
                ],
                "summary": "List conversations",
                "operationId": "d0787cf7d4056891131a5119a906b463",
                "parameters": [
                    {
                        "name": "status",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "open",
                                "pending",
                                "closed"
                            ]
                        }
                    },
                    {
                        "name": "priority",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "low",
                                "medium",
                                "high"
                            ]
                        }
                    },
                    {
                        "name": "search",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "per_page",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "maximum": 100,
                            "minimum": 1
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Conversation list"
                    },
                    "401": {
                        "description": "Unauthenticated"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            },
            "post": {
                "tags": [
                    "Conversations"
                ],
                "summary": "Create a conversation with first message",
                "operationId": "316073d2250b45b7a44a1d9e6d211fd7",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "content"
                                ],
                                "properties": {
                                    "content": {
                                        "type": "string",
                                        "example": "Halo, saya butuh bantuan untuk akun saya."
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Conversation created"
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "403": {
                        "description": "Forbidden"
                    },
                    "422": {
                        "description": "Validation error"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        },
        "/api/conversations/inbox": {
            "get": {
                "tags": [
                    "Conversations"
                ],
                "summary": "Inbox conversations sorted by priority and last message time",
                "operationId": "69754380362a6da2772888f065924104",
                "parameters": [
                    {
                        "name": "per_page",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "maximum": 100,
                            "minimum": 1
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Inbox list"
                    },
                    "401": {
                        "description": "Unauthenticated"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        },
        "/api/conversations/{conversation}": {
            "get": {
                "tags": [
                    "Conversations"
                ],
                "summary": "Get conversation detail",
                "operationId": "261ff719e5d2ed68e2fd6494321005ce",
                "parameters": [
                    {
                        "name": "conversation",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    },
                    {
                        "name": "before_id",
                        "in": "query",
                        "required": false,
                        "schema": {
                            "type": "integer",
                            "minimum": 1
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Conversation detail"
                    },
                    "401": {
                        "description": "Unauthenticated"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        },
        "/api/conversations/{conversation}/messages": {
            "post": {
                "tags": [
                    "Conversations"
                ],
                "summary": "Send a message to a conversation",
                "operationId": "18ef3485ad7c8e27090e700283f2bd02",
                "parameters": [
                    {
                        "name": "conversation",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "content"
                                ],
                                "properties": {
                                    "content": {
                                        "type": "string",
                                        "example": "We are looking into your issue."
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Updated conversation"
                    },
                    "401": {
                        "description": "Unauthenticated"
                    },
                    "422": {
                        "description": "Validation error"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        },
        "/api/user": {
            "get": {
                "tags": [
                    "Auth"
                ],
                "summary": "Get authenticated user",
                "operationId": "fc335bce9afe0939b94d8609a69303c0",
                "responses": {
                    "200": {
                        "description": "Authenticated user"
                    },
                    "401": {
                        "description": "Unauthenticated"
                    }
                },
                "security": [
                    {
                        "sanctum": []
                    }
                ]
            }
        }
    },
    "components": {
        "securitySchemes": {
            "sanctum": {
                "type": "http",
                "description": "Use your Bearer token from Laravel Sanctum",
                "bearerFormat": "Token",
                "scheme": "bearer"
            }
        }
    },
    "tags": [
        {
            "name": "AI Insights",
            "description": "AI Insights"
        },
        {
            "name": "Email Verification",
            "description": "Email Verification"
        },
        {
            "name": "Auth",
            "description": "Auth"
        },
        {
            "name": "Conversations",
            "description": "Conversations"
        }
    ]
}